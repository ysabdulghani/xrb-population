#!/bin/bash
#SBATCH --account=group-annelohfink
#SBATCH --partition=nextgen
#SBATCH --cpus-per-task=96
#SBATCH --mem=64G
#SBATCH --time=2-00:00:00
#SBATCH --job-name=xrt-simulation-job-1
#SBATCH --output=/home/r77m975/xrb-population/out_logs/job_1/job-1-%A_%a-%j.out
#SBATCH --error=/home/r77m975/xrb-population/out_logs/job_1/job-1-%A_%a-%j.err
#SBATCH --mail-user=youssef.abdulghani@student.montana.edu
#SBATCH --mail-type=ALL
#SBATCH --array=0-287

echo "Running on node: $(hostname)"

# Progress tracking setup
progress_file="/home/r77m975/xrb-population/out_logs/job_1/progress.log"
touch $progress_file

# Execute commands

    param_index=$SLURM_ARRAY_TASK_ID
    g=$(echo "1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7,1.7" | cut -d',' -f$((param_index+1)))
    T=$(echo "0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7" | cut -d',' -f$((param_index+1)))
    a=$(echo "0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998,0.998" | cut -d',' -f$((param_index+1)))
    m=$(echo "6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,6.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0,8.0" | cut -d',' -f$((param_index+1)))
    i=$(echo "0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,80.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0,60.0" | cut -d',' -f$((param_index+1)))
    r=$(echo "0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9,0.2,0.2,0.2,0.5,0.5,0.5,0.9,0.9,0.9" | cut -d',' -f$((param_index+1)))
    e=$(echo "400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000,400.0,1000,5000" | cut -d',' -f$((param_index+1)))

    # Log progress to the unique progress file
    params="g=$g, T=$T, a=$a, m=$m, i=$i, r=$r, e=$e"
    echo "Job $SLURM_JOB_ID, Task $SLURM_ARRAY_TASK_ID: Running combination $param_index: $params" >> $progress_file

    # Execute the command
    apptainer exec -c --mount 'type=bind,source=/home/r77m975/xrb-population/,destination=/home/r77m975/xrb-population' --pwd /home/r77m975/xrb-population/ /home/r77m975/heasoft_docker/heasoft-v6.34.sif python /home/r77m975/xrb-population/observational_effects.py $g $T $a $m $i $r $e xrt
    
